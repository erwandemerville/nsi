<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animation Boyer-Moore-Horspool</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .container { margin: 20px auto; width: 80%; }
        .input-group { margin-bottom: 10px; }
        table { margin: 10px auto; border-collapse: collapse; font-size: 20px; }
        td { padding: 5px; border: 1px solid black; min-width: 20px; text-align: center; }
        .highlight { background-color: yellow; border: 2px solid red; }
        .compare { background-color: lightblue; }
        .mismatch { background-color: lightcoral; }
        .shift-highlight { background-color: yellow; }
        .controls button { margin: 5px; padding: 10px; }
        .info { margin-top: 20px; font-size: 18px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Animation de l'algorithme Boyer-Moore-Horspool</h1>
        <div class="input-group">
            <label for="texte">Texte :</label>
            <input type="text" id="texte" value="agracadabra">
            <label for="motif">Motif :</label>
            <input type="text" id="motif" value="abra">
        </div>
        <div class="controls">
            <button onclick="startAnimation()">Exécuter</button>
            <button onclick="stepForward()">Avancer</button>
            <button onclick="stepBackward()">Reculer</button>
            <button onclick="toggleAutoPlay()" id="autoButton">Automatique</button>
        </div>
        <table>
            <tr id="text-display"></tr>
            <tr id="pattern-display"></tr>
        </table>
        <div class="info" id="info"></div>
        <div class="info" id="shift-table"></div>
    </div>

    <script>
        let text, pattern, shiftTable, steps = [], stepIndex = 0, autoInterval, isAutoPlaying = false;

        function computeShiftTable(motif) {
            let table = {};
            for (let i = 0; i < motif.length - 1; i++) {
                table[motif[i]] = motif.length - 1 - i;
            }
            return table;
        }

        function startAnimation() {
            text = document.getElementById("texte").value;
            pattern = document.getElementById("motif").value;
            shiftTable = computeShiftTable(pattern);
            document.getElementById("shift-table").innerText = "Table de décalage : " + JSON.stringify(shiftTable);
            steps = [];
            stepIndex = 0;
            executeAlgorithm();
        }

        function executeAlgorithm() {
            let i = 0;
            while (i <= text.length - pattern.length) {
                let j = pattern.length - 1;
                while (j >= 0) {
                    let match = text[i + j] === pattern[j];
                    steps.push({ index: i, match: j, type: "compare", isMatch: match });
                    if (!match) break;
                    j--;
                }
                if (j < 0) {
                    steps.push({ index: i, found: true });
                    break;
                }
                let shiftChar = text[i + pattern.length - 1];
                let shift = shiftTable[shiftChar] || pattern.length;
                let shiftReason = shiftChar in shiftTable 
                    ? `Le caractère <span style="color: #ff782b">'<strong>${shiftChar}</strong>'</span> est dans la table de décalage.` 
                    : `Le caractère <span style="color: #ff782b">'<strong>${shiftChar}</strong>'</span> n'est pas dans la table, décalage de la longueur du motif.`;
                steps.push({ index: i, shift: shift, shiftReason: shiftReason, shiftChar: shiftChar });
                i += shift;
            }
            // Si on atteint la fin du texte sans trouver le motif, ajouter un message final
            if (i > text.length - pattern.length) {
                steps.push({ notFound: true });
            }
            // Mettre à jour l'affichage
            updateDisplay();
        }

        function updateDisplay() {
            if (stepIndex < 0) stepIndex = 0;
            if (stepIndex >= steps.length) return;
            let step = steps[stepIndex];
            
            let textHTML = text.split('').map((c, idx) => {
                let classes = "";
                if (idx === step.index + step.match) classes += step.isMatch ? "compare" : "mismatch";
                if (step.shiftChar && idx === step.index + pattern.length - 1) classes += " shift-highlight";
                return `<td class="${classes}">${c}</td>`;
            }).join('');
            document.getElementById("text-display").innerHTML = textHTML;

            let patternHTML = "<td></td>".repeat(step.index) + pattern.split('').map((c, idx) => {
                let classes = "";
                if (step.type === "compare" && idx === step.match) classes += step.isMatch ? "compare" : "mismatch";
                return `<td class="${classes}">${c}</td>`;
            }).join('');
            document.getElementById("pattern-display").innerHTML = patternHTML;

            if (step.type === "compare") {
                document.getElementById("info").innerText = `Comparaison : ${text[step.index + step.match]} ${step.isMatch ? "==" : "!="} ${pattern[step.match]}`;
            } else if (step.found) {
                document.getElementById("info").innerText = "Motif trouvé !";
            } else if (step.notFound) {
                document.getElementById("info").innerText = "Fin du parcours, le motif n'a pas été trouvé.";
            } else {
                document.getElementById("info").innerHTML = `${step.shiftReason}<br /> Décalage de ${step.shift} positions.`;
            }
        }

        function stepForward() {
            if (stepIndex < steps.length) {
                stepIndex++;
                updateDisplay();
            }
        }

        function stepBackward() {
            if (stepIndex > 0) {
                stepIndex--;
                updateDisplay();
            }
        }

        function toggleAutoPlay() {
            if (isAutoPlaying) {
                clearInterval(autoInterval);
                isAutoPlaying = false;
                document.getElementById("autoButton").innerText = "Automatique";
            } else {
                isAutoPlaying = true;
                document.getElementById("autoButton").innerText = "Arrêter";
                autoInterval = setInterval(() => {
                    if (stepIndex >= steps.length) {
                        clearInterval(autoInterval);
                        isAutoPlaying = false;
                        document.getElementById("autoButton").innerText = "Automatique";
                    }
                    stepForward();
                }, 1000);
            }
        }
    </script>
</body>
</html>
